<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Final Results</title>
<style>
  :root{
    --bg:#081a34; --panel:#0f2b57; --line:#1f468b; --text:#ffffff; --muted:#a8c1ff; --accent:#ffd24a;
  }
  html,body{margin:0;background:transparent;font-family:Trebuchet MS,Arial,sans-serif;color:var(--text)}
  .wrap{max-width:900px;margin:24px auto;padding:16px 20px;background:var(--panel);
        border:3px solid var(--line); border-radius:16px; box-shadow:0 10px 24px rgba(0,0,0,.3)}
  h1{margin:0 0 8px;font-size:28px; letter-spacing:.5px}
  .sub{color:var(--muted); margin-bottom:16px}
  table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px}
  th,td{padding:12px 14px; border-bottom:1px solid var(--line)}
  th{text-align:left; background:#12366e}
  .rank{width:70px; text-align:center}
  .score{text-align:right; font-weight:900}
  .total{margin-top:16px; display:flex; justify-content:flex-end; gap:24px; font-size:18px}
  .btns{margin-top:12px; display:flex; gap:10px}
  button{background:var(--accent); border:2px solid #fff; border-radius:10px; padding:8px 12px; font-weight:900; cursor:pointer}
  .mutebtn{background:#264d8f; color:#fff}
  .empty{padding:12px; border:2px dashed var(--line); border-radius:10px; text-align:center; color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1 id="title">Final Results</h1>
  <div class="sub">Scores are sorted from lowest to highest.</div>

  <div id="empty" class="empty" style="display:none">No results found yet. Complete the role-play and quizzes.</div>

  <table id="tbl" style="display:none">
    <thead><tr><th class="rank">#</th><th>Section</th><th class="score">Score</th></tr></thead>
    <tbody></tbody>
  </table>

  <div id="totals" class="total" style="display:none">
    <div><strong>Average:</strong> <span id="avg">0</span></div>
    <div><strong>Total:</strong> <span id="sum">0</span></div>
  </div>

  <div class="btns">
    <button class="mutebtn" onclick="window.location.reload()">Refresh</button>
    <button onclick="clearAll()">Clear My Results (testing)</button>
  </div>
</div>

<script>
(function(){
  var uname = (localStorage.getItem("dm_username") || "Player").trim();
  document.getElementById("title").textContent = uname + " — Final Results";

  // Read saved parts
  var parts = JSON.parse(localStorage.getItem("dm_parts")||"[]");

  if (!parts.length){
    document.getElementById('empty').style.display = '';
    return;
  }

  // Sort low → high
  parts.sort(function(a,b){ return (a.score||0) - (b.score||0); });

  // Render
  var tbody = document.querySelector('#tbl tbody');
  var sum = 0;
  var isPercent = guessPercent(parts);

  parts.forEach(function(p, idx){
    var tr = document.createElement('tr');
    sum += (+p.score||0);

    var td1 = document.createElement('td'); td1.className='rank'; td1.textContent = (idx+1);
    var td2 = document.createElement('td'); td2.textContent = p.label || ('Part ' + p.id);
    var td3 = document.createElement('td'); td3.className='score';
    td3.textContent = (Number.isFinite(+p.score) ? (+p.score).toFixed(2) : '0') + (isPercent ? '%' : '');
    tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3);
    tbody.appendChild(tr);
  });

  document.getElementById('tbl').style.display = '';
  var avg = sum / parts.length;
  var suffix = isPercent ? '%' : '';
  document.getElementById('sum').textContent = sum.toFixed(2) + suffix;
  document.getElementById('avg').textContent = avg.toFixed(2) + suffix;
  document.getElementById('totals').style.display = '';
})();

function clearAll(){
  // Useful while testing
  // (keeps the name so you don’t need to retype every time)
  localStorage.removeItem('dm_parts');
  window.location.reload();
}

function guessPercent(list){
  if(!list.length) return true;
  var max = Math.max.apply(null, list.map(function(p){return +p.score||0;}));
  return max <= 100; // ≤100 ⇒ treat as percent
}
</script>
</body>
</html>
